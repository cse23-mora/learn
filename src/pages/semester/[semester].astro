---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	return [
		{ params: { semester: '2nd' } },
		{ params: { semester: '3rd' } }
	];
}

const { semester } = Astro.params;

// Get all docs to count lessons
const docs = await getCollection('docs');

// Function to count lessons for a subject
function getLessonCount(semester: string, subjectSlug: string): number {
	const subjectPath = `${semester}-semester/${subjectSlug}`;
	return docs.filter(doc => 
		doc.id.startsWith(subjectPath) && 
		doc.id !== `${subjectPath}/index` &&
		!doc.id.includes('/index.mdx') &&
		!doc.id.match(/\.(png|jpg|jpeg|gif|svg)$/i)
	).length;
}

const semesterData = {
	'2nd': {
		title: '2nd Semester',
		subjects: [
			{
				name: 'Data Structures & Algorithms',
				slug: 'data-structures-algorithms',
				description: 'Fundamental data structures, algorithms, and their analysis'
			},
			{
				name: 'Computer Organization and Digital Design',
				slug: 'computer-organization',
				description: 'Computer architecture, digital logic, and system organization'
			},
			{
				name: 'Methods of Mathematics',
				slug: 'methods-of-mathematics',
				description: 'Mathematical methods and numerical techniques'
			},
			{
				name: 'Program Construction',
				slug: 'program-construction',
				description: 'Software design patterns and programming methodologies'
			},
			{
				name: 'Theory of Electricity',
				slug: 'theory-of-electricity',
				description: 'Electrical circuits, signals, and electromagnetic theory'
			},
			{
				name: 'Communication Skills',
				slug: 'communication-skills',
				description: 'Written and verbal communication techniques'
			}
		]
	},
	'3rd': {
		title: '3rd Semester',
		subjects: [
			{
				name: 'AI (Artificial Intelligence)',
				slug: 'ai',
				description: 'Machine learning, neural networks, and AI algorithms'
			},
			{
				name: 'Computer Architecture',
				slug: 'computer-architecture',
				description: 'Advanced computer system design and architecture'
			},
			{
				name: 'Thermodynamics',
				slug: 'thermodynamics',
				description: 'Heat transfer, energy systems, and thermodynamic cycles'
			},
			{
				name: 'Database Systems',
				slug: 'database-systems',
				description: 'Database design, SQL, and data management systems'
			},
			{
				name: 'Differential Equations (DE)',
				slug: 'differential-equations',
				description: 'Mathematical modeling with differential equations'
			},
			{
				name: 'Operating Systems',
				slug: 'operating-systems',
				description: 'Process management, memory, and system programming'
			},
			{
				name: 'Communication Skills',
				slug: 'communication-skills',
				description: 'Advanced communication and presentation skills'
			},
			{
				name: 'Data Communication & Networking',
				slug: 'data-communication-networking',
				description: 'Network protocols, communication systems, and security'
			},
			{
				name: 'Applied Statistics',
				slug: 'applied-statistics',
				description: 'Statistical analysis, probability, and data interpretation'
			}
		]
	}
};

const currentSemester = semesterData[semester as keyof typeof semesterData];

if (!currentSemester) {
	return Astro.redirect('/');
}
---

<Layout title={`${currentSemester.title} | Knowledge Hub`}>
	<!-- Breadcrumbs -->
	<div class="text-sm breadcrumbs mb-6">
		<ul>
			<li><a href="/">Home</a></li>
			<li class="font-semibold">{currentSemester.title}</li>
		</ul>
	</div>

	<!-- Header -->
	<div class="mb-8">
		<h1 class="text-4xl font-bold mb-3 text-primary">
			{currentSemester.title}
		</h1>
		<p class="text-lg opacity-70">Choose a subject to explore lessons and materials</p>
	</div>

	<!-- Stats -->
	<div class="stats stats-vertical lg:stats-horizontal shadow mb-8 w-full">
		<div class="stat">
			<div class="stat-figure text-primary">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
				</svg>
			</div>
			<div class="stat-title">Total Subjects</div>
			<div class="stat-value text-primary">{currentSemester.subjects.length}</div>
			<div class="stat-desc">Available for this semester</div>
		</div>

		<div class="stat">
			<div class="stat-figure text-primary">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
				</svg>
			</div>
			<div class="stat-title">Total Lessons</div>
			<div class="stat-value text-primary">
				{currentSemester.subjects.reduce((acc, subject) => acc + getLessonCount(semester!, subject.slug), 0)}
			</div>
			<div class="stat-desc">Notes and resources</div>
		</div>
	</div>

	<!-- Subjects Grid -->
	<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
		{currentSemester.subjects.map((subject) => {
			const lessonCount = getLessonCount(semester!, subject.slug);
			return (
				<a
					href={`/subject/${semester}/${subject.slug}`}
					class="card bg-base-100 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1 border border-base-300"
				>
					<div class="card-body">
						<h2 class="card-title text-lg">
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
							</svg>
							{subject.name}
						</h2>
						<p class="text-sm opacity-70 flex-grow">{subject.description}</p>
						<div class="card-actions justify-between items-center mt-4">
							<div class="badge badge-primary badge-outline">
								{lessonCount} {lessonCount === 1 ? 'lesson' : 'lessons'}
							</div>
							<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
							</svg>
						</div>
					</div>
				</a>
			);
		})}
	</div>
</Layout>